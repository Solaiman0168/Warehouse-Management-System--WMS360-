<?php

namespace App\Http\Controllers;

use App\AttributeTerm;
use http\Env\Response;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use PHPUnit\Exception;
use Pixelpeter\Woocommerce\Facades\Woocommerce;
use App\Attribute;
use App\AttributeTermProductDraft;

class WooController extends Controller
{
    public function category(){
        //$result = Woocommerce::get('products/categories?offset=0&per_page=100');
        $array1 = array();
        $array2 = array();
        $offset=0;
        $page =100;
        $temp = 1;
        try{
            while(true){
                $result = Woocommerce::get('orders?offset='.$offset.'&per_page='.$page);

                $array2 = array_merge($array2, $result) ;
                $offset=$offset+100;
                if (empty($result)){
                    break;
                }
            }
            $result = json_decode(json_encode($array2));
            $array = array();
            foreach ($result as $result){
                $array[] = array('id' =>$result->id,'name' => $result->name);
            }

            $fp = fopen('category.csv', 'w');

            foreach ($array as $fields) {
                fputcsv($fp, $fields);
            }

            fclose($fp);
            return response()->json($array2);
        }catch (Exception $exception){

        }

    }
    public function attributeList(){
        $results = Woocommerce::get('products/attributes');
        $array2 = array();
        $offset=0;
        $page =100;
        $temp = 1;
        try{
            while(true){
                //$result = Woocommerce::get('products/categories?offset='.$offset.'&per_page='.$page);
                $results = Woocommerce::get('products/attributes?offset='.$offset.'&per_page='.$page);
                $array2 = array_merge($array2, $result) ;
                $offset=$offset+100;
                if (empty($result)){
                    break;
                }
            }
            $result = json_decode(json_encode($array2));
            $array = array();
            foreach ($result as $result){
                $array[] = array('id' =>$result->id,'name' => $result->name);
            }

            $fp = fopen('cat.csv', 'w');

            foreach ($array as $fields) {
                fputcsv($fp, $fields);
            }

            fclose($fp);
            return response()->json($array2);
        }catch (Exception $exception){

        }
        return response()->json($results);
    }

    public function attributeTermsList(){
        //$results = Woocommerce::get('products/attributes/0terms?filter=['custom']&offset='.$offset.'&per_page='.$page);
        set_time_limit(21000);
        $array2 = array();
        $offset=0;
        $page =100;
        $temp = 1;
//        $result = Woocommerce::get('products/attributes/5/terms?offset='.$offset.'&per_page='.$page);
//        return response()->json($result);
//        exit();
        try{
            while(true){
                $result = Woocommerce::get('products/attributes/8/terms?offset='.$offset.'&per_page='.$page);
                $array2 = array_merge($array2, $result) ;
                $offset=$offset+100;
                if (empty($result)){
                    break;
                }
            }
            $result = json_decode(json_encode($array2));

            $array = array();
            foreach ($result as $result){
                $array[] = array('id' =>$result->id,'name' => $result->name);
            }
            $fp = fopen('terms_design-15-01.csv', 'w');
            foreach ($array as $fields) {
                fputcsv($fp, $fields);
            }
            fclose($fp);
            return response()->json($array2);
        }catch (Exception $exception){
        }
        return response()->json($result);
    }

    public function draftProduct(){
//        $result = Woocommerce::get('products');
        set_time_limit(21000);
        $array2 = array();
        $offset=0;
        $page =100;

        //$array2 = array(56557,56566,56580,56559,56596,56598,56606,56623,56637,56645,56644,56661,56672,56662,56768,56790,56797,56801,56809,56819,56799,56835,56844,56854,56861,56870,56881,56892,56900,56908,56933,56940,56947,56958,56972,56980,56990,57000,57006,57014,57022,57032,57042,57068,57070,57084,57092,57103,57122,57181,57191,57198,57207,57215,57226,57280,57288,57301,57307,57312,57320,57335,57345,57354,57362,57375,57387,57398);

        try{

            while(true){
                $result = Woocommerce::get('products?offset='.$offset.'&per_page='.$page);


                $array2 = array_merge($array2, $result) ;

                $offset=$offset+100;
                $result = json_decode(json_encode($array2));

                    $array = array();
                    foreach ($result as $result){
                        if($result->type == 'variable'){
                            $array[] = array('id' =>$result->id,'name' => $result->name,'type' => $result->type,
                                'description' => $result->description,'short_description' => $result->short_description,'regular_price' => $result->regular_price,
                                'sale_price' => $result->sale_price,'status' => $result->status,'date_created' => $result->date_created,'date_modified' => $result->date_modified );
                        }
                    }

                    $fp = fopen('product_draft.csv', 'w');

                    foreach ($array as $fields) {
                        fputcsv($fp, $fields);
                    }

                    fclose($fp);



                $fp = fopen('offset.csv', 'w');


                fputcsv($fp, ['offset'=>$offset]);

                fclose($fp);


            }

            return response()->json($array2);

        }catch (Exception $exception){

        }

//        return response()->json($result);
    }

    public function draftProductCategory(){
//        $result = Woocommerce::get('products');
        set_time_limit(21000);
        $array2 = array();
        $offset=0;
        $page =100;
        try{

            while(true){
                $result = Woocommerce::get('products?offset='.$offset.'&per_page='.$page);

                $array2 = array_merge($array2, $result) ;
                $result = json_decode(json_encode($array2));
                $array = array();
                foreach ($result as $result){
                    foreach ($result->categories as $category){
                        $array[] = array('product_draft_id' =>$result->id,'category_id' => $category->id);
                    }

                }

                $fp = fopen('product_draft_category.csv', 'w');

                foreach ($array as $fields) {
                    fputcsv($fp, $fields);
                }

                fclose($fp);
                $offset=$offset+100;
                if (empty($result)){
                    break;
                }
            }

            return response()->json($array2);

        }catch (Exception $exception){

        }

//        return response()->json($result);
    }


    public function draftProductImage(){
//        $result = Woocommerce::get('products');
        set_time_limit(500);
        $array2 = array();
        $offset=0;
        $page =100;
        $temp = 1;
        try{
            while(true){
                $curl = curl_init();
//                $result = Woocommerce::get('products?offset='.$offset.'&per_page='.$page);
                $url = 'https://www.topbrandoutlet.co.uk/wp-json/wc/v2/products?offset='.$offset.'&per_page='.$page.'&consumer_key=ck_e71bf2f730f5456a9e2c928db1b8e3b651a8fb46&consumer_secret=cs_916535ee8163f2efe58ef9f657651c6e7e83f67f';
                curl_setopt_array($curl, array(
                    CURLOPT_URL => $url,
                    CURLOPT_RETURNTRANSFER => true,
                    CURLOPT_ENCODING => "",
                    CURLOPT_MAXREDIRS => 10,
                    CURLOPT_TIMEOUT => 300,
                    CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
                    CURLOPT_CUSTOMREQUEST => "GET",
                    CURLOPT_SSL_VERIFYPEER=> false,

                    CURLOPT_HTTPHEADER => array(
                        "Authorization: Basic *****************",
                        "Cache-Control: no-cache"
                    ),
                ));

                $result = curl_exec( $curl) ;
                curl_close( $curl );
                $result = json_decode($result);

                $array2 = array_merge($array2, $result) ;
                $result = json_decode(json_encode($array2));
                $array = array();
                foreach ($result as $result){
                    foreach ($result->images as $image){
                        $array[] = array('id' => $image->id,'product_draft_id' =>$result->id,'image_url' => $image->src);
                    }

                }

                $fp = fopen('product_draft_image.csv', 'w');

                foreach ($array as $fields) {
                    fputcsv($fp, $fields);
                }

                fclose($fp);
                $offset=$offset+100;
                if (empty($result)){
                    break;
                }
            }

            return response()->json($array2);

        }catch (Exception $exception){

        }

//        return response()->json($result);
    }


    public function ProductVariationQuantity(){
    set_time_limit(21000);
    $product_draft_id = array(57398,57387,57375,57362,57354,57345,57335,57320,57312,57307,57301,57288,57280,57226,57215,57207,57198,57191,57181,57122,57103,57092,57084,57070,57068,57042,57032,57022,57014,57006,57000,56990,56980,56972,56958,56947,56940,56933,56908,56900,56892,56881,56870,56861,56854,56844,56835,56799,56819,56809,56801,56797,56790,56768,56662,56672,56661,56644,56645,56637,56623,56606,56598,56596,56559,56580,56566,56557,56552,56535,56533,56525,56498,56490,56478,56471,56465,56462,56452,56440,56438,56425,56400,56373,56389,56379,56364,56356,56344,56339,56326,56302,56310,56267,56259,56251,56239,56230,56222,56205,56062,56187,56155,56143,56135,56124,56109,56102,56103,56084,56082,56065,56063,56050,56038,56023,56025,56010,55997,55975,55968,55959,55951,55944,55935,55926,55918,55910,55903,55896,55866,55858,55851,55840,55830,55820,55743,55736,55729,55717,55710,55701,55683,55670,55657,55647,55638,55616,55623,55611,55531,55499,55515,55498,55481,55467,55457,55440,55434,55420,55366,55349,55339,55326,55308,55288,55275,55199,55188,55178,55171,55162,55149,55136,55121,55110,55101,54972,54961,54950,54933,54920,54906,54869,54855,54838,54828,54819,54807,54796,54780,54765,54701,54687,54673,54655,54640,54632,54589,54580,54572,54563,54552,54542,54531,54523,54514,54464,54442,54428,54430,54309,54295,54277,54268,54260,54251,54237,54217,54202,54151,54114,54133,54124,54115,54098,54097,54076,54074,53995,53977,53980,53968,53796,53890,53888,53876,53867,53866,53860,53848,53837,53825,53806,53811,53793,53776,53766,53753,53745,53737,53725,53726,53638,53685,53672,53650,53648,53632,53621,53612,53602,53589,53581,53568,53571,53534,53557,53526,53517,53510,53500,53494,53479,53470,53459,53451,53433,53422,53415,53407,53400,53358,53223,53219,53197,53196,53184,53172,53164,53148,53139,53132,53122,53051,53040,53029,53018,53003,52992,52980,52972,52958,52949,52934,52919,52901,52854,52838,52816,52801,52781,52770,52760,52731,52591,52573,52551,52536,52513,52501,52492,52442,52432,52424,52411,52400,52389,52377,52370,52360,52350,52341,52329,52321,52312,52302,52289,52281,52271,52256,52242,52227,52212,52202,52194,52187,52178,52169,52161,52047,52036,52019,52005,51891,51882,51873,51862,51847,51835,51825,51768,51761,51743,51726,51715,51705,51696,51683,51662,51622,51610,51589,51582,51575,51566,51501,51413,51395,51387,51381,51371,51362,51278,51268,51259,51249,51170,51162,51151,51144,51132,51119,51095,51085,51074,51063,51056,51013,50974,50961,50950,50936,50921,50917,50910,50897,50890,50841,50818,50810,50797,50735,50724,50714,50704,50696,50651,50646,50636,50621,50614,50607,50597,50587,50570,50569,50552,50555,50524,50544,50533,50512,50510,50500,50493,50486,50444,50424,50412,50406,50396,50291,50282,50266,50252,50246,50238,50192,50164,50158,50145,50135,50128,50123,50117,50111,50099,50052,49976,49960,49945,49932,49913,49907,49874,49891,49875,49869,49863,49767,49797,49789,49781,49721,49706,49693,49685,49678,49663,49657,49659,49645,49593,49586,49580,49572,49561,49555,49546,49539,49506,49474,49462,49450,49398,49385,49378,49373,49359,49351,49278,49265,49273,49251,49225,49183,49167,49161,49156,49139,49132,49125,49117,49107,49093,49079,49071,49058,49044,49043,49037,49028,49007,49020,49005,48999,48989,48978,48967,48943,48924,48921,48902,48894,48886,48872,48867,48859,48847,48826,48836,48810,48789,48764,48766,48758,48725,48710,48704,48702,48665,48660,48649,48590,48646,48578,48571,48485,48566,48561,48554,48549,48545,48536,48530,48523,48517,48508,48482,48475,48446,48462,48438,48424,48411,48407,48399,48391,48383,48350,48341,48315,48329,48303,48270,48234,48215,48196,48188,48000,48173,48157,48043,48038,48016,47998,47981,47948,47949,47925,47896,47908,47889,47877,47869,47858,47842,47843,47830,47739,47809,47798,47463,47457,47451,47436,47427,47381,47361,47356,47327,47315,47280,47263,47229,47230,47217,47203,47205,47184,47113,47073,46974,46930,46960,46946,46937,46925,46793,46788,46783,46779,46772,46765,46755,46748,46594,46513,46404,46395,45759,46373,46352,46341,46319,46300,46285,46251,46069,46061,46051,46043,46008,45999,45986,45977,45968,45960,45949,45941,45931,45908,45888,45815,45859,45851,45842,45825,45807,45786,45774,45629,45667,45688,45656,45646,45611,45560,45556,45546,45520,45482,45470,45465,45429,45412,45399,45394,45382,45320,45275,45265,45154,45119,45096,45065,45032,45005,44979,44967,44959,44950,44930,44911,44756,44711,44662,44663,44646,44634,44629,44620,44619,44523,44514,44506,44486,44481,44465,44460,44455,44444,44433,44426,44391,44351,44292,44336,44330,44293,44276,44271,44265,44257,44253,44248,44244,44234,44227,44220,44213,44209,44201,44197,44191,44186,44182,44178,44112,44107,44101,44095,44089,44083,44078,44072,44065,44061,44003,44014,43992,43955,43870,43867,43863,43860,43855,43851,43849,43845,43839,43836,43807,43821,43806,43790,43787,43784,43772,43765,43762,43751,43705,43701,43698,43693,43695,43689,43686,43674,43660,43652,43624,43621,43620,43584,43614,43591,43593,43585,43579,43576,43567,43494,43501,43495,43486,43467,43461,43449,43441,43379,43355,43339,43365,43347,43334,43318,43311,43306,43226,41428,41414,41346,40192,40183,40174,40161,39927,39916,39864,39907,39861,39845,39835,39823,39812,39802,39792,39782,39772,39762,39756,39673,39654,39426,39427,39411,39399,39398,39210,39189,39176,39170,39156,39124,39110,39096,38955,38924,38918,38914,38909,38899,38833,38830,38665,38643,38633,38614,38597,38590,38584,38571,38564,38551,38550,38396,38382,38375,38366,38060,37997,37950,37933,37857,37780,37771,37744,37730,37693,37677,37659,37651,37640,37402,37372,37359,37308,37144,37090,37066,36982,37005,36983,36528,36503,36486,36466,36452,36415,36398,36390,36382,36365,36359,36099,36064,36055,36029,36018,36012,36000,35946,35981,35978,35939,35913,35844,35828,35788,35793,35776,35754,35715,35680,35673,35347,35336,35310,35327,35303,35270,35294,35277,35250,35181,35226,35167,35160,35122,35148,35106,35094,35086,35035,35021,35007,34995,34982,34971,34866,34897,34882,34850,34836,34819,34784,34779,34737,34756,34724,34719,34711,34640,34491,34490,34457,34422,34388,34356,34284,34248,34195,33926,33929,33908,33909,33882,33904,33861,33830,33816,33552,33522,33506,33492,33478,33466,33458,33417,33371,33279,33270,33257,33241,33232,33229,33208,33198,33184,33172,33164,33155,33146,33047,33038,33025,33009,33004,32981,32982,32956,32957,32941,32938,32914,32900,32906,32895,32878,32879,32868,32850,32843,32837,32822,32821,32812,32801,32550,32552,32528,32518,32473,32501,32462,32428,32398,32411,32383,32373,32363,32347,32342,32321,32315,32232,32225,32208,32203,32167,32172,32158,32151,32143,32047,32039,32018,32027,31990,31977,31963,31950,31956,31934,31935,31920,31908,31873,31834,31867,31861,31822,31807,31806,31797,31798,31775,31771,31766,31759,31677,31669,31655,31651,31635,31583,31574,31567,31565,31502,31494,31479,31470,31461,31456,31449,31437,31321,31295,31290,31266,31258,31223,31216,31215,31204,31190,31184,31080,31065,30973,30960,30942,30938,30928,30929,30904,30866,30807,30774,30765,30758,30742,30723,30682,30583,30571,30562,30520,30552,30546,30534,30532,30509,30475,30470,30464,30437,30431,30421,30401,30357,30376,30367,30343,30341,30326,30301,30288,30289,30222,30219,30210,30202,30197,30191,30166,30158,30150,30141,30136,30128,30110,30119,30106,30090,30074,30083,30060,30047,30040,30030,30004,30016,29996,29984,29975,29968,29963,29669,29619,29609,29527,29497,29433,29323,29309,29290,29297,29294,29272,29281,29269,29252,29260,29239,29223,29179,29190,29082,29058,29040,29016,29041,29015,28998,28988,28963,28948,28834,28826,28819,28812,28809,28807,28777,28709,28647,28639,28554,28534,28532,28509,28495,28494,28492,28431,28422,28408,28388,28372,28360,28332,28300,28278,28243,28002,27987,27892,27837,27828,27649,27321,27313,27305,27297,27289,27267,27254,27235,27196,27134,27109,27076,27067,27022,26999,26969,26981,26593,26588,26515,26499,26493,26487,26462,26435,26388,26309,26239,26230,26250,26186,25645,25629,25599,25588,25584,25564,25473,25424,25401,25370,25116,25108,25091,25050,25066,25036,25009,25001,24950,24984,24973,24951,24934,24944,24901,24817,24810,24804,24803,24783,24776,24722,24715,24580,24571,24551,24533,24502,24485,24453,24386,24109,24103,24090,24067,24062,24058,24045,24052,24040,24015,23994,23821,23806,23772,23771,23757,23754,23735,23719,23559,23538,23512,23508,23515,23479,23483,23477,23476,23460,23451,23351,23339,23107,23088,23060,23056,23026,22882,22858,22848,22843,22836,22804,22789,22779,22626,22462,22430,22400,22376,22381,22361,22272,22226,22216,22179,22207,22183,22117,22161,22116,22112,22113,22103,21990,21972,21960,21950,21916,21845,21726,21686,21658,21600,21585,21579,21566,21557,21531,21507,21298,21281,21276,21256,21230,21234,21226,21172,21174,21161,20954,21122,21029,21013,20997,20986,20978,20962,20953,20945,20841,20840,20812,20818,20781,20771,20743,20753,20742,20700,20725,20711,20701,20690,20677,20671,20483,20464,20454,20434,20399,20392,20375,20318,20305,20300,20220,20189,20003,19962,19981,19972,19893,19951,19945,19914,19908,19899,19885,19875,19871,19775,19766,19743,19736,19374,19365,19349,19233,19218,19177,19163,19147,19138,19125,19008,18987,18970,18955,18923,18874,18789,18775,18765,18758,18612,18581,18569,18549,18520,18500,18490,18484,18475,18460,18435,18426,18355,18348,18331,18260,18172,18148,18134,17994,17973,17915,17852,17807,17789,17675,17653,17638,17617,17633,17619,17595,17566,17540,17522,17507,17469,17450,17433,17410,17359,17344,17262,17325,17291,17285,17270,17261,17256,17244,17229,17217,17190,17156,17137,17129,17110,17082,17062,17043,17010,17005,16986,16987,16967,16968,16936,16942,16935,16916,16839,16833,16827,16803,16777,16776,16771,16760,16725,16705,16688,16684,16657,16632,16623,16579,16573,16560,16488,16481,16475,16476,16469,16464,16460,16450,16441,16436,16429,16420,16414,16372,16355,16350,16344,16258,16234,16217,16202,16017,16016,15967,15950,15948,15913,15914,15892,15710,15599,15589,15468,15459,15446,15381,15427,15411,15376,15368,15361,15341,15335,15328,15319,15286,15280,15254,15255,15229,15174,15212,15223,15178,15143,15162,15135,15132,15101,15094,15074,15072,15024,15051,15027,14980,14975,14954,14930,14912,14897,14885,14818,14829,14817,14826,14790,14778,14763,14757,14749,14724,14633,14639,14632,14597,14574,14575,14564,14556,14511,14536,14512,14444,14432,14413,14391,14382,14371,14367,14355,14303,14290,14278,14261,14248,14229,14211,14127,14117,14103,14088,14080,14072,14061,14060,14049,14041,14032,14015,13993,13926,13979,13901,13883,13858,13787,13842,13821,13757,13781,13775,13749,13699,13703,13698,13688,13645,13623,13606,13601,12857,13590,13583,13577,13570,13537,13529,13518,13498,13485,13473,13463,13455,13444,13426,13390,13365,13374,13261,13229,13150,13179,13154,13141,13103,13118,13123,13080,13071,13044,12996,13015,12971,12970,12947,12925,12926,12915,12892,12878,12879,12870,12856,12849,12827,12808,12801,12788,12742,12736,12725,12716,12698,12689,12679,12646,12633,12616,12601,12589,12577,12569,12518,12519,12503,12489,12473,12409,12393,12363,12331,12338,12256,11614,12301,12302,12286,12273,12241,12224,12218,12193,12174,12161,12152,12140,12112,12102,12097,12067,12055,12054,12037,12030,12018,12013,11987,11998,11997,11977,11969,11961,11949,11922,11863,11854,11838,11831,11819,11812,11785,11748,11742,11740,11717,11705,11694,11683,11668,11659,11638,11627,11625,11615,11596,11585,11571,11561,11555,11549,11541,11529,11523,11496,11491,11486,11447,11438,11357,11348,11325,11317,11307,11299,11289,11226,11207,11202,11191,11185,11181,11165,11155,11148,11147,11136,11130,11110,11094,11092,11071,11055,11026,11012,10957,10988,10971,10956,10945,10866,10640,10557,10489,10419,10418,10406,10392,10348,10371,10318,10317,10301,10274,10281,10255,10207,10206,10191,10175,10162,10148,10127,10079,10041,10019,10018,9964,9970,9946,9928,9921,9889,9879,9857,9843,9832,9821,9810,9752,9747,9731,9693,9686,9641,9638,9637,9602,9634,9623,9549,9496,9490,9464,9460,9447,9430,9408,9375,9351,9279,9233,9247,9209,9199,9174,9169,9128,9088,9052,9042,9032,9006,8993,8982,8920,8906,8857,8828,8786,8738,8739,8718,8680,8707,8661,8670,8610,8567,8553,8531,8498,8480,8474,8388,8382,8377,8359,8333,8316,8285,8231,8212,8155,8090,8027,8014,7829,7831,7777,7817,7780,7761,7762,7735,7719,7630,7421,7407,7401,7364,7362,7332,7309,7297,7256,7225,7190,7171,7172,7102,7119,7080,6899,6893,6888,6880,6872,6856,6849,6801,6772,6757,6756,6470,6598,6563,6552,6538,6525,6513,6501,6413,6392,6376,6340,6319,6308,6289,6280,6164,6047,6036,5966,5944,5921,5809,5447,5408,5369,5247);
    $option = array();
    $array2 = array();
    $array = array();
    $counter =0;

    while(!empty($product_draft_id[$counter])){
        try{
            $result1 = Woocommerce::get('products/'.$product_draft_id[$counter]);

            $result1 = json_decode(json_encode($result1));

            if($result1->type == 'variable'){
                $result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations?offset=10&per_page=100');
//                return $result;
                $result = json_decode(json_encode($result));


                if(!empty($result)){
                    foreach ($result as $variation){


//                    foreach ($variation->image as $image){
//                             $array[] = array('id' => $variation->id !=null ? $variation->id : '','product_draft_id' => $result1->id !=null ? $result1->id : '','image' => $variation->image->src !=null ? $variation->image->src : '',
//                                 'attribute1'=> 5,'sku' => $variation->sku,'regular_price' => $variation->regular_price,'sale_price' => $variation->sale_price,
//                                 'description' => $variation->description);


                            $array[] = array('invoice_id' => 1,'product_variation_id' => $variation->id !=null ? $variation->id : '','shelver_user_id' => 2,'quantity' => $variation->stock_quantity,'shelved_quantity' => 0,'price' => 0,'shelving_status' => 0,'product_type' => 1,'total_price' => 0);

                            # code...

                        $fp = fopen('invoice_product_variation.csv', 'w');

                        foreach ($array as $fields) {
                            fputcsv($fp, $fields);
                        }

                        fclose($fp);
                        //}
                    }
                    $fp = fopen('invoice_product_variation_counter.csv', 'w');


                    fputcsv($fp, ['counter'=>$counter,'draft_product_id' => $product_draft_id[$counter]]);


                    fclose($fp);
                }
            }

            $counter++;
        }catch(Exception $e){

        }
        //$result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations');

    }


    //return response()->json($result);
}

    public function ProductVariation(){
        set_time_limit(30000);
        $product_draft_id = array(33552,33522,33506,33492,33478,33466,33458,33417,33371,33279,33270,33257,33241,33232,33229,33208,33198,33184,33172,33164,33155,33146,33047,33038,33025,33009,33004,32981,32982,32956,32957,32941,32938,32914,32900,32906,32895,32878,32879,32868,32850,32843,32837,32822,32821,32812,32801,32550,32552,32528,32518,32473,32501,32462,32428,32398,32411,32383,32373,32363,32347,32342,32321,32315,32232,32225,32208,32203,32167,32172,32158,32151,32143,32047,32039,32018,32027,31990,31977,31963,31950,31956,31934,31935,31920,31908,31873,31834,31867,31861,31822,31807,31806,31797,31798,31775,31771,31766,31759,31677,31669,31655,31651,31635,31583,31574,31567,31565,31502,31494,31479,31470,31461,31456,31449,31437,31321,31295,31290,31266,31258,31223,31216,31215,31204,31190,31184,31080,31065,30973,30960,30942,30938,30928,30929,30904,30866,30807,30774,30765,30758,30742,30723,30682,30583,30571,30562,30520,30552,30546,30534,30532,30509,30475,30470,30464,30437,30431,30421,30401,30357,30376,30367,30343,30341,30326,30301,30288,30289,30222,30219,30210,30202,30197,30191,30166,30158,30150,30141,30136,30128,30110,30119,30106,30090,30074,30083,30060,30047,30040,30030,30004,30016,29996,29984,29975,29968,29963,29669,29619,29609,29527,29497,29433,29323,29309,29290,29297,29294,29272,29281,29269,29252,29260,29239,29223,29179,29190,29082,29058,29040,29016,29041,29015,28998,28988,28963,28948,28834,28826,28819,28812,28809,28807,28777,28709,28647,28639,28554,28534,28532,28509,28495,28494,28492,28431,28422,28408,28388,28372,28360,28332,28300,28278,28243,28002,27987,27892,27837,27828,27649,27321,27313,27305,27297,27289,27267,27254,27235,27196,27134,27109,27076,27067,27022,26999,26969,26981,26593,26588,26515,26499,26493,26487,26462,26435,26388,26309,26239,26230,26250,26186,25645,25629,25599,25588,25584,25564,25473,25424,25401,25370,25116,25108,25091,25050,25066,25036,25009,25001,24950,24984,24973,24951,24934,24944,24901,24817,24810,24804,24803,24783,24776,24722,24715,24580,24571,24551,24533,24502,24485,24453,24386,24109,24103,24090,24067,24062,24058,24045,24052,24040,24015,23994,23821,23806,23772,23771,23757,23754,23735,23719,23559,23538,23512,23508,23515,23479,23483,23477,23476,23460,23451,23351,23339,23107,23088,23060,23056,23026,22882,22858,22848,22843,22836,22804,22789,22779,22626,22462,22430,22400,22376,22381,22361,22272,22226,22216,22179,22207,22183,22117,22161,22116,22112,22113,22103,21990,21972,21960,21950,21916,21845,21726,21686,21658,21600,21585,21579,21566,21557,21531,21507,21298,21281,21276,21256,21230,21234,21226,21172,21174,21161,20954,21122,21029,21013,20997,20986,20978,20962,20953,20945,20841,20840,20812,20818,20781,20771,20743,20753,20742,20700,20725,20711,20701,20690,20677,20671,20483,20464,20454,20434,20399,20392,20375,20318,20305,20300,20220,20189,20003,19962,19981,19972,19893,19951,19945,19914,19908,19899,19885,19875,19871,19775,19766,19743,19736,19374,19365,19349,19233,19218,19177,19163,19147,19138,19125,19008,18987,18970,18955,18923,18874,18789,18775,18765,18758,18612,18581,18569,18549,18520,18500,18490,18484,18475,18460,18435,18426,18355,18348,18331,18260,18172,18148,18134,17994,17973,17915,17852,17807,17789,17675,17653,17638,17617,17633,17619,17595,17566,17540,17522,17507,17469,17450,17433,17410,17359,17344,17262,17325,17291,17285,17270,17261,17256,17244,17229,17217,17190,17156,17137,17129,17110,17082,17062,17043,17010,17005,16986,16987,16967,16968,16936,16942,16935,16916,16839,16833,16827,16803,16777,16776,16771,16760,16725,16705,16688,16684,16657,16632,16623,16579,16573,16560,16488,16481,16475,16476,16469,16464,16460,16450,16441,16436,16429,16420,16414,16372,16355,16350,16344,16258,16234,16217,16202,16017,16016,15967,15950,15948,15913,15914,15892,15710,15599,15589,15468,15459,15446,15381,15427,15411,15376,15368,15361,15341,15335,15328,15319,15286,15280,15254,15255,15229,15174,15212,15223,15178,15143,15162,15135,15132,15101,15094,15074,15072,15024,15051,15027,14980,14975,14954,14930,14912,14897,14885,14818,14829,14817,14826,14790,14778,14763,14757,14749,14724,14633,14639,14632,14597,14574,14575,14564,14556,14511,14536,14512,14444,14432,14413,14391,14382,14371,14367,14355,14303,14290,14278,14261,14248,14229,14211,14127,14117,14103,14088,14080,14072,14061,14060,14049,14041,14032,14015,13993,13926,13979,13901,13883,13858,13787,13842,13821,13757,13781,13775,13749,13699,13703,13698,13688,13645,13623,13606,13601,12857,13590,13583,13577,13570,13537,13529,13518,13498,13485,13473,13463,13455,13444,13426,13390,13365,13374,13261,13229,13150,13179,13154,13141,13103,13118,13123,13080,13071,13044,12996,13015,12971,12970,12947,12925,12926,12915,12892,12878,12879,12870,12856,12849,12827,12808,12801,12788,12742,12736,12725,12716,12698,12689,12679,12646,12633,12616,12601,12589,12577,12569,12518,12519,12503,12489,12473,12409,12393,12363,12331,12338,12256,11614,12301,12302,12286,12273,12241,12224,12218,12193,12174,12161,12152,12140,12112,12102,12097,12067,12055,12054,12037,12030,12018,12013,11987,11998,11997,11977,11969,11961,11949,11922,11863,11854,11838,11831,11819,11812,11785,11748,11742,11740,11717,11705,11694,11683,11668,11659,11638,11627,11625,11615,11596,11585,11571,11561,11555,11549,11541,11529,11523,11496,11491,11486,11447,11438,11357,11348,11325,11317,11307,11299,11289,11226,11207,11202,11191,11185,11181,11165,11155,11148,11147,11136,11130,11110,11094,11092,11071,11055,11026,11012,10957,10988,10971,10956,10945,10866,10640,10557,10489,10419,10418,10406,10392,10348,10371,10318,10317,10301,10274,10281,10255,10207,10206,10191,10175,10162,10148,10127,10079,10041,10019,10018,9964,9970,9946,9928,9921,9889,9879,9857,9843,9832,9821,9810,9752,9747,9731,9693,9686,9641,9638,9637,9602,9634,9623,9549,9496,9490,9464,9460,9447,9430,9408,9375,9351,9279,9233,9247,9209,9199,9174,9169,9128,9088,9052,9042,9032,9006,8993,8982,8920,8906,8857,8828,8786,8738,8739,8718,8680,8707,8661,8670,8610,8567,8553,8531,8498,8480,8474,8388,8382,8377,8359,8333,8316,8285,8231,8212,8155,8090,8027,8014,7829,7831,7777,7817,7780,7761,7762,7735,7719,7630,7421,7407,7401,7364,7362,7332,7309,7297,7256,7225,7190,7171,7172,7102,7119,7080,6899,6893,6888,6880,6872,6856,6849,6801,6772,6757,6756,6470,6598,6563,6552,6538,6525,6513,6501,6413,6392,6376,6340,6319,6308,6289,6280,6164,6047,6036,5966,5944,5921,5809,5447,5408,5369,5247);
        $option = array();
        $array2 = array();
        $array = array();
        $counter =0;
        while(!empty($product_draft_id[$counter])){
            try{
                $result1 = Woocommerce::get('products/'.$product_draft_id[$counter]);
                $result1 = json_decode(json_encode($result1));
                $result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations?offset=0&per_page=100');
                //return $result;
                $result = json_decode(json_encode($result));
                if(!empty($result)){
                    foreach ($result as $variation){
//                    foreach ($variation->image as $image){
//                             $array[] = array('id' => $variation->id !=null ? $variation->id : '','product_draft_id' => $result1->id !=null ? $result1->id : '','image' => $variation->image->src !=null ? $variation->image->src : '',
//                                 'attribute1'=> 5,'sku' => $variation->sku,'regular_price' => $variation->regular_price,'sale_price' => $variation->sale_price,
//                                 'description' => $variation->description);

                        //return $variation;
                        foreach ($variation->attributes as $attribute) {
                            $result = Attribute::where('attribute_name',$attribute->name)->first();
                            if ($attribute->name == "Size"){
                                $option['size'] = $attribute->option;
                            }elseif ($attribute->name == "Colour"){
                                $option['colour'] = $attribute->option;
                            }elseif ($attribute->name == "Style"){
                                $option['style'] = $attribute->option;
                            }

                        }
                        $array[] = array('id' => $variation->id !=null ? $variation->id : '','product_draft_id' => $result1->id !=null ? $result1->id : '','image' => !empty($variation->image) ? $variation->image->src : '',
                            'attribute1'=> isset($option['size']) !=null ? $option['size'] : null,'attribute2'=> isset($option['colour']) !=null ? $option['colour'] : null,'attribute3'=> isset($option['style']) !=null ? $option['style'] : null,'sku' => $variation->sku !=null ? $variation->sku : null,'regular_price' => $variation->regular_price !=null ? $variation->regular_price : null,'sale_price' => $variation->sale_price !=null ?  $variation->sale_price : null,
                            'description' => $variation->description,'date_created' => $variation->date_created,'date_updated' =>$variation->date_modified);
                        # code...
                        $option['size']= NULL;
                        $option['colour'] = NULL;
                        $option['style'] = NULL;

                        $fp = fopen('variation_offset_14-01.csv', 'w');
                        foreach ($array as $fields) {
                            fputcsv($fp, $fields);
                        }
                        fclose($fp);
                        //}
                    }
                }

                $fp = fopen('product_variation_counter_14-01.csv', 'w');
//                fputcsv($fp, ['counter'=>$counter,'draft_product_id' => $product_draft_id[$counter]]);
                fputcsv($fp, ['counter'=>$counter,'draft_product_id' => $product_draft_id[$counter]]);
                fclose($fp);
                $counter++;
            }
            catch(Exception $e){
            }
        }
        //$result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations');
    }

    public function test1(){
        set_time_limit(21000);
        $product_draft_id = array(9721,9686,9646,9641,9642,9638,9637,9602,9634,9623,9549,9537,9516,9517,9497,9496,9490,9464,9460,9447,9430,9408,9395,9375,9351,9291,9279,9267,9264,9233,9247,9218,9209,9199,9174,9169,9154,9140,9128,9118,9108,9098,9088,9077,9066,9052,9042,9032,9018,9006,8993,8982,8972,8920,8906,8896,8883,8857,8866,8828,8817,8830,8816,8806,8786,8763,8762,8738,8739,8717,8718,8680,8707,8661,8670,8656,8651,8608,8610,8588,8587,8567,8553,8547,8531,8532,8514,8498,8497,8480,8474,8419,8402,8388,8382,8377,8359,8333,8316,8298,8285,8275,8254,8261,8231,8232,8212,8205,8201,8180,8181,8163,8154,8155,8133,8132,8113,8111,8092,8090,8072,8027,8014,8004,7953,7905,7889,7864,7829,7831,7777,7817,7780,7761,7762,7746,7735,7719,7708,7698,7676,7665,7642,7630,7412,7421,7407,7401,7364,7362,7356,7339,7331,7332,7309,7297,7270,7271,7244,7256,7246,7225,7224,7207,7208,7190,7189,7171,7172,7157,7145,7123,7102,7119,7080,6950,7054,7039,7027,7013,6993,6987,6974,6962,6935,6920,6919,6905,6904,6899,6893,6888,6886,6880,6878,6877,6875,6872,6869,6856,6855,6849,6848,6846,6844,6840,6836,6801,6788,6772,6759,6758,6757,6756,6744,6732,6721,6710,6697,6685,6673,6655,6644,6632,6470,6613,6598,6587,6563,6552,6538,6525,6513,6501,6491,6478,6450,6441,6413,6392,6376,6366,6352,6340,6330,6319,6308,6289,6280,6268,6256,6244,6221,6232,6219,6220,6199,6184,6177,6178,6058,6165,6164,6093,6139,6127,6116,6106,6080,6069,6047,6036,6024,6012,6000,5988,5977,5966,5955,5944,5933,5921,5909,5863,5897,5885,5852,5841,5830,5809,5783,5772,5761,5750,5728,5716,5500,5464,5447,5408,5394,5375,5369,5247);
        $array2 = array();

        $counter =0;

        while(!empty($product_draft_id[$counter])){
            //$result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations');
            $result1 = Woocommerce::get('products/'.$product_draft_id[$counter]);

            $result1 = json_decode(json_encode($result1));


            if($result1->type == 'variable'){
                $result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations?offset=0&per_page=100');
                $result = json_decode(json_encode($result));

                if(!empty($result)){
                    foreach ($result as $variation){
                    foreach ($variation->attributes as $attribute){
                        //echo $attribute->option;
//                        $string = $attribute->option;
//                        $str_arr = explode (" ", $string);
//                        foreach ($str_arr as $term){
//                            $terms_result = AttributeTerm::where('terms_name' , $term)->get();
//                            print_r($terms_result);
//                            //exit();
//                        }

                        $attribute_result = Attribute::where('attribute_name', $attribute->name)->first();

                        $attribute_terms_result = AttributeTerm::where('terms_name', $attribute->option)->first();
//                        return $attribute_terms_result;

                        if (!isset($attribute_terms_result)){
                             //$info = Woocommerce::get('products/attributes/'.$attribute_terms_result->attribute_id.'/terms/'.$attribute_terms_result->id);
//                             $info = Woocommerce::get('products/attributes/'.'5'.'/terms/'.'1515');
//                             return $info;
//                             exit();
                             $data = [
                                    'name' => $attribute->option
                                ];

                                $info = Woocommerce::post('products/attributes/' . $attribute_result->id . '/terms', $data);

//                                $request['id'] = $info['id'];
                                $add_attributes_terms = AttributeTerm::create(['id' => $info['id'] !=null ? $info['id'] : null,'attribute_id' => $attribute_result->id !=null ? $attribute_result->id : null,'terms_name' => $attribute->option !=null ? $attribute->option : null]);



                            $array[] = array('product_draft_id' =>$result1->id !=null ? $result1->id : null,'attribute_term_id' =>  $info['id'] !=null ? $info['id'] : null,'attribute_id' => $attribute_result->id !=null ? $attribute_result->id : null);
                            $fp = fopen('terms_product_draft_offset.csv', 'w');

                            foreach ($array as $fields) {
                                fputcsv($fp, $fields);
                            }

                            fclose($fp);
                        }else{

                            $array[] = array('product_draft_id' =>$result1->id != null ?  $result1->id : null,'attribute_term_id' =>  $attribute_terms_result->id != null ?  $attribute_terms_result->id : null,'attribute_id' => $attribute_result->id != null ?  $attribute_result->id : null);
                            $fp = fopen('terms_product_draft_offset.csv', 'w');

                            foreach ($array as $fields) {
                                fputcsv($fp, $fields);
                            }
                        }

                        }

                    }

                }


            }
            $fp = fopen('counter_offset.csv', 'w');


            fputcsv($fp, ['counter'=>$counter,'prdo'=>$product_draft_id[$counter]]);


            fclose($fp);
            $counter++;
        }
        return \response()->json($result1);
    }
    public function test(){
        set_time_limit(21000);
        //10866,
        $product_draft_id = array(39124,39110,39096,38955,38924,38918,38914,38909,38899,38833,38830,38665,38643,38633,38614,38597,38590,38584,38571,38564,38551,38550,38396,38382,38375,38366,38060,37997,37950,37933,37857,37780);
        $array2 = array();
        $counter =0;
        while(!empty($product_draft_id[$counter])){
            //$result = Woocommerce::get('products/'.$product_draft_id[$counter].'/variations');
            $result1 = Woocommerce::get('products/'.$product_draft_id[$counter]);

            $result1 = json_decode(json_encode($result1));
            if($result1->type == 'variable'){
                $result = Woocommerce::get('products/'.$result1->id.'/variations?offset=0&per_page=100');
                //return $result;
                $result = json_decode(json_encode($result));
                if(!empty($result)){
                    foreach ($result as $variation){
                        foreach ($variation->attributes as $attribute){

                            //echo $attribute->option;
//                        $string = $attribute->option;
//                        $str_arr = explode (" ", $string);
//                        foreach ($str_arr as $term){
//                            $terms_result = AttributeTerm::where('terms_name' , $term)->get();
//                            print_r($terms_result);
//                            //exit();
//                        }
                            $attribute_result = Attribute::where('attribute_name', $attribute->name)->first();
                            $attribute_terms_result = AttributeTerm::where('terms_name', $attribute->option)->first();


                            if (empty($attribute_terms_result)){
//                                return $attribute->option;
                               // return response()->json($variation) ;
                                //$info = Woocommerce::get('products/attributes/'.$attribute_terms_result->attribute_id.'/terms/'.$attribute_terms_result->id);
//                             $info = Woocommerce::get('products/attributes/'.'5'.'/terms/'.'1515');
//                             return $info;
//                             exit();
                                $data = [
                                    'name' => $attribute->option
                                ];
                                $info = Woocommerce::post('products/attributes/' . $attribute_result->id . '/terms', $data);
                                //return $info;
//                                $request['id'] = $info['id'];
                                $add_attributes_terms = AttributeTerm::create(['id' => $info['id'] !=null ? $info['id'] : null,'attribute_id' => $attribute_result->id !=null ? $attribute_result->id : null,'terms_name' => $attribute->option !=null ? $attribute->option : null]);
                                $query_result = AttributeTermProductDraft::where(['product_draft_id' =>$result1->id,'attribute_term_id' =>  $info['id'] ,'attribute_id' => $attribute_result->id])->get()->first();
                                if (empty($query_result)){
                                    AttributeTermProductDraft::create(['product_draft_id' =>$result1->id,'attribute_term_id' =>  $info['id'] ,'attribute_id' => $attribute_result->id]);
                                    //$array[] = array('product_draft_id' =>$result1->id !=null ? $result1->id : null,'attribute_term_id' =>  $info['id'] !=null ? $info['id'] : null,'attribute_id' => $attribute_result->id !=null ? $attribute_result->id : null);
//                                    $fp = fopen('attributes_terms_product_draft4.csv', 'w');
//                                    foreach ($array as $fields) {
//                                        fputcsv($fp, $fields);
//                                    }
//                                    fclose($fp);
                                }
                                $query_result =null;
                                $attribute_result =null;
                                $attribute_terms_result = null;
                                $data = null;
                            }else {
//                                return $result1->id.' '.$attribute_terms_result->id.' '.$attribute_result->id;
                                $query_result = AttributeTermProductDraft::where(['product_draft_id' =>$result1->id,'attribute_term_id' =>  $attribute_terms_result->id ,'attribute_id' => $attribute_result->id ])->get()->first();
                                //return $query_result;
                                if (empty($query_result)){
//                                    $array[] = array('product_draft_id' =>$result1->id != null ?  $result1->id : null,'attribute_term_id' =>  $attribute_terms_result->id != null ?  $attribute_terms_result->id : null,'attribute_id' => $attribute_result->id != null ?  $attribute_result->id : null);
//
//                                    $fp = fopen('attributes_terms_product_draft4.csv', 'w');
//                                    foreach ($array as $fields) {
//                                        fputcsv($fp, $fields);
//                                    }
//                                    fclose($fp);
                                    AttributeTermProductDraft::create(['product_draft_id' =>$result1->id,'attribute_term_id' =>  $attribute_terms_result->id ,'attribute_id' => $attribute_result->id ]);
                                }
                                $query_result =null;
                                $attribute_result =null;
                                $attribute_terms_result = null;
                                $data = null;
                            }
                        }
                    }

                }
            }
            $fp = fopen('counter_draft_product4.csv', 'w');
            fputcsv($fp, ['counter'=>$counter,'id'=>$product_draft_id[$counter]]);
            fclose($fp);
            $counter++;
        }
        return \response()->json($result1);
    }
}
